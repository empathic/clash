[meta]
name = "multi-level settings merging"
description = "Test that settings from multiple levels merge correctly with proper precedence"

[settings.user]
permissions.allow = ["Bash(git:*)", "Read"]

[settings.project]
permissions.deny = ["Read(.env)", "Read(.secret)"]
permissions.allow = ["Bash(npm run test)"]

[[step]]
name = "user-level git allow still works"
hook = "pre-tool-use"
tool_name = "Bash"
tool_input = { command = "git log" }

[step.expect]
decision = "allow"

[[step]]
name = "project-level npm allow works"
hook = "pre-tool-use"
tool_name = "Bash"
tool_input = { command = "npm run test" }

[step.expect]
decision = "allow"

[[step]]
name = "project-level deny .env works"
hook = "pre-tool-use"
tool_name = "Read"
tool_input = { file_path = ".env" }

[step.expect]
decision = "deny"

[[step]]
name = "project-level deny .secret works"
hook = "pre-tool-use"
tool_name = "Read"
tool_input = { file_path = ".secret" }

[step.expect]
decision = "deny"

[[step]]
name = "unconfigured write should ask"
hook = "pre-tool-use"
tool_name = "Write"
tool_input = { file_path = "/tmp/test.txt", content = "hello" }

[step.expect]
decision = "ask"
