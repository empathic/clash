meta:
  name: v2 sexpr policy â€” network rules
  description: Test net capability rules for WebFetch and WebSearch

clash:
  policy_sexpr: |
    (default deny "main")
    (policy "main"
      (allow (net "github.com"))
      (allow (net "api.github.com"))
      (deny (net "evil.com")))

steps:
  - name: webfetch github.com allowed
    hook: pre-tool-use
    tool_name: WebFetch
    tool_input:
      url: "https://github.com/anthropics/claude-code"
    expect:
      decision: allow

  - name: webfetch api.github.com allowed
    hook: pre-tool-use
    tool_name: WebFetch
    tool_input:
      url: "https://api.github.com/repos"
    expect:
      decision: allow

  - name: webfetch evil.com denied
    hook: pre-tool-use
    tool_name: WebFetch
    tool_input:
      url: "https://evil.com/payload"
    expect:
      decision: deny

  - name: webfetch unknown domain denied by default
    hook: pre-tool-use
    tool_name: WebFetch
    tool_input:
      url: "https://example.com/page"
    expect:
      decision: deny

  - name: websearch denied by default
    hook: pre-tool-use
    tool_name: WebSearch
    tool_input:
      query: "test query"
    expect:
      decision: deny
