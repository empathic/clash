meta:
  name: basic permission enforcement
  description: Test that allow/deny rules produce the correct decisions

settings:
  user:
    permissions:
      allow:
        - "Bash(git:*)"
        - Read
      deny:
        - "Read(.env)"
        - "Bash(rm -rf:*)"

steps:
  - name: git status should be allowed
    hook: pre-tool-use
    tool_name: Bash
    tool_input:
      command: git status
    expect:
      decision: allow
      reason_contains: policy

  - name: git diff should be allowed (prefix match)
    hook: pre-tool-use
    tool_name: Bash
    tool_input:
      command: "git diff --cached"
    expect:
      decision: allow

  - name: read any file should be allowed
    hook: pre-tool-use
    tool_name: Read
    tool_input:
      file_path: /tmp/somefile.txt
    expect:
      decision: allow

  - name: read .env should be denied (deny overrides allow)
    hook: pre-tool-use
    tool_name: Read
    tool_input:
      file_path: ".env"
    expect:
      decision: deny
      reason_contains: policy

  - name: rm -rf should be denied
    hook: pre-tool-use
    tool_name: Bash
    tool_input:
      command: "rm -rf /"
    expect:
      decision: deny

  - name: unconfigured command should ask
    hook: pre-tool-use
    tool_name: Bash
    tool_input:
      command: "curl https://example.com"
    expect:
      decision: ask
